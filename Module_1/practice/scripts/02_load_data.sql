-- ============================================================
-- Практикум по анализу и моделированию данных
-- Модуль 1. Практическая работа: Обзор структур хранения
-- Скрипт 2: Загрузка данных из CSV в PostgreSQL
-- ============================================================

SET search_path TO ruda_plus, public;

-- ============================================================
-- Вариант А: Загрузка через COPY (из файлов на сервере)
-- Используется если CSV-файлы доступны на сервере PostgreSQL
-- ============================================================

-- COPY equipment FROM '/path/to/data/equipment.csv'
--     WITH (FORMAT csv, HEADER true, DELIMITER ',', ENCODING 'UTF8');

-- COPY sensor_readings FROM '/path/to/data/sensor_readings.csv'
--     WITH (FORMAT csv, HEADER true, DELIMITER ',', ENCODING 'UTF8');

-- COPY ore_production FROM '/path/to/data/ore_production.csv'
--     WITH (FORMAT csv, HEADER true, DELIMITER ',', ENCODING 'UTF8');

-- COPY downtime_events FROM '/path/to/data/downtime_events.csv'
--     WITH (FORMAT csv, HEADER true, DELIMITER ',', ENCODING 'UTF8');


-- ============================================================
-- Вариант Б: Загрузка через INSERT (универсальный способ)
-- Используется если нет прямого доступа к файловой системе
-- ============================================================

-- Очищаем таблицы перед загрузкой (в правильном порядке)
TRUNCATE sensor_readings, ore_production, downtime_events, equipment CASCADE;

-- ---------- Оборудование ----------
INSERT INTO equipment VALUES
('EQ-001','ПДМ-01','Погрузочно-доставочная машина','Sandvik','LH517i',2021,'MINE-1','Шахта Северная','В работе','2025-12-15','2026-03-15',12450,17.0),
('EQ-002','ПДМ-02','Погрузочно-доставочная машина','Caterpillar','R1700',2022,'MINE-1','Шахта Северная','В работе','2026-01-10','2026-04-10',8930,15.0),
('EQ-003','ПДМ-03','Погрузочно-доставочная машина','Sandvik','LH514',2020,'MINE-2','Шахта Южная','На ТО','2026-02-01','2026-02-15',18200,14.0),
('EQ-004','СС-01','Шахтный самосвал','Sandvik','TH663i',2021,'MINE-1','Шахта Северная','В работе','2025-11-20','2026-02-20',14100,63.0),
('EQ-005','СС-02','Шахтный самосвал','Caterpillar','AD63',2023,'MINE-1','Шахта Северная','В работе','2026-01-05','2026-04-05',5200,63.0),
('EQ-006','СС-03','Шахтный самосвал','Sandvik','TH551i',2019,'MINE-2','Шахта Южная','В работе','2025-12-20','2026-03-20',21300,51.0),
('EQ-007','СС-04','Шахтный самосвал','Sandvik','TH663i',2022,'MINE-2','Шахта Южная','Простой','2026-01-25','2026-04-25',9800,63.0),
('EQ-008','ВГ-01','Вагонетка','УралМаш','ВГ-4.5',2018,'MINE-1','Шахта Северная','В работе','2025-10-10','2026-04-10',0,4.5),
('EQ-009','ВГ-02','Вагонетка','УралМаш','ВГ-4.5',2018,'MINE-1','Шахта Северная','В работе','2025-10-10','2026-04-10',0,4.5),
('EQ-010','ВГ-03','Вагонетка','УралМаш','ВГ-6.0',2020,'MINE-2','Шахта Южная','В работе','2025-11-15','2026-05-15',0,6.0),
('EQ-011','СП-01','Скиповый подъемник','НКМЗ','СП-12',2017,'MINE-1','Шахта Северная','В работе','2026-01-20','2026-07-20',42000,12.0),
('EQ-012','СП-02','Скиповый подъемник','НКМЗ','СП-15',2019,'MINE-2','Шахта Южная','В работе','2025-12-05','2026-06-05',31500,15.0);

-- ---------- Показания датчиков ----------
INSERT INTO sensor_readings VALUES
('SR-000001','EQ-001','Температура двигателя',82.5,'°C','2026-02-10 08:00:12','OK'),
('SR-000002','EQ-001','Давление гидравлики',245.0,'бар','2026-02-10 08:00:12','OK'),
('SR-000003','EQ-001','Уровень топлива',68.3,'%','2026-02-10 08:00:12','OK'),
('SR-000004','EQ-001','Вибрация',2.1,'мм/с','2026-02-10 08:00:12','OK'),
('SR-000005','EQ-001','Температура двигателя',84.1,'°C','2026-02-10 08:15:07','OK'),
('SR-000006','EQ-001','Давление гидравлики',242.8,'бар','2026-02-10 08:15:07','OK'),
('SR-000007','EQ-001','Уровень топлива',67.1,'%','2026-02-10 08:15:07','OK'),
('SR-000008','EQ-001','Вибрация',2.3,'мм/с','2026-02-10 08:15:07','OK'),
('SR-000009','EQ-001','Температура двигателя',91.7,'°C','2026-02-10 08:30:05','WARN'),
('SR-000010','EQ-001','Давление гидравлики',238.5,'бар','2026-02-10 08:30:05','OK'),
('SR-000011','EQ-001','Уровень топлива',65.8,'%','2026-02-10 08:30:05','OK'),
('SR-000012','EQ-001','Вибрация',4.8,'мм/с','2026-02-10 08:30:05','WARN'),
('SR-000013','EQ-001','Температура двигателя',105.3,'°C','2026-02-10 08:45:10','ALARM'),
('SR-000014','EQ-001','Давление гидравлики',220.1,'бар','2026-02-10 08:45:10','WARN'),
('SR-000015','EQ-001','Уровень топлива',64.2,'%','2026-02-10 08:45:10','OK'),
('SR-000016','EQ-001','Вибрация',7.2,'мм/с','2026-02-10 08:45:10','ALARM'),
('SR-000017','EQ-004','Температура двигателя',78.2,'°C','2026-02-10 08:00:15','OK'),
('SR-000018','EQ-004','Давление гидравлики',310.5,'бар','2026-02-10 08:00:15','OK'),
('SR-000019','EQ-004','Масса груза',58.7,'т','2026-02-10 08:00:15','OK'),
('SR-000020','EQ-004','Скорость',12.4,'км/ч','2026-02-10 08:00:15','OK'),
('SR-000021','EQ-004','Температура двигателя',79.8,'°C','2026-02-10 08:15:20','OK'),
('SR-000022','EQ-004','Давление гидравлики',308.2,'бар','2026-02-10 08:15:20','OK'),
('SR-000023','EQ-004','Масса груза',61.2,'т','2026-02-10 08:15:20','OK'),
('SR-000024','EQ-004','Скорость',10.8,'км/ч','2026-02-10 08:15:20','OK'),
('SR-000025','EQ-004','Температура двигателя',80.5,'°C','2026-02-10 08:30:18','OK'),
('SR-000026','EQ-004','Давление гидравлики',305.0,'бар','2026-02-10 08:30:18','OK'),
('SR-000027','EQ-004','Масса груза',0.0,'т','2026-02-10 08:30:18','OK'),
('SR-000028','EQ-004','Скорость',18.5,'км/ч','2026-02-10 08:30:18','OK'),
('SR-000029','EQ-005','Температура двигателя',75.0,'°C','2026-02-10 08:00:22','OK'),
('SR-000030','EQ-005','Давление гидравлики',315.8,'бар','2026-02-10 08:00:22','OK'),
('SR-000031','EQ-005','Масса груза',55.3,'т','2026-02-10 08:00:22','OK'),
('SR-000032','EQ-005','Скорость',14.2,'км/ч','2026-02-10 08:00:22','OK'),
('SR-000033','EQ-011','Масса скипа',11.8,'т','2026-02-10 08:05:00','OK'),
('SR-000034','EQ-011','Скорость подъема',8.2,'м/с','2026-02-10 08:05:00','OK'),
('SR-000035','EQ-011','Натяжение каната',142.5,'кН','2026-02-10 08:05:00','OK'),
('SR-000036','EQ-011','Масса скипа',11.5,'т','2026-02-10 08:12:30','OK'),
('SR-000037','EQ-011','Скорость подъема',8.0,'м/с','2026-02-10 08:12:30','OK'),
('SR-000038','EQ-011','Натяжение каната',140.2,'кН','2026-02-10 08:12:30','OK'),
('SR-000039','EQ-011','Масса скипа',12.0,'т','2026-02-10 08:20:15','OK'),
('SR-000040','EQ-011','Скорость подъема',7.8,'м/с','2026-02-10 08:20:15','OK'),
('SR-000041','EQ-011','Натяжение каната',145.8,'кН','2026-02-10 08:20:15','WARN'),
('SR-000042','EQ-002','Температура двигателя',77.3,'°C','2026-02-10 08:00:18','OK'),
('SR-000043','EQ-002','Давление гидравлики',250.2,'бар','2026-02-10 08:00:18','OK'),
('SR-000044','EQ-002','Уровень топлива',45.1,'%','2026-02-10 08:00:18','WARN'),
('SR-000045','EQ-002','Вибрация',1.8,'мм/с','2026-02-10 08:00:18','OK'),
('SR-000046','EQ-006','Температура двигателя',88.9,'°C','2026-02-10 08:00:25','OK'),
('SR-000047','EQ-006','Давление гидравлики',298.4,'бар','2026-02-10 08:00:25','OK'),
('SR-000048','EQ-006','Масса груза',48.5,'т','2026-02-10 08:00:25','OK'),
('SR-000049','EQ-006','Скорость',11.0,'км/ч','2026-02-10 08:00:25','OK'),
('SR-000050','EQ-006','Температура двигателя',92.4,'°C','2026-02-10 08:15:30','WARN');

-- ---------- Добыча руды ----------
INSERT INTO ore_production VALUES
('PRD-001','MINE-1','Шахта Северная','2026-02-10',1,'Горизонт -320м','BLK-N-101','Магнетит',125.4,32.5,4.2,'EQ-001','Петров И.С.','06:00','14:00','Завершена'),
('PRD-002','MINE-1','Шахта Северная','2026-02-10',1,'Горизонт -320м','BLK-N-102','Магнетит',98.7,34.1,3.8,'EQ-002','Сидоров А.В.','06:00','14:00','Завершена'),
('PRD-003','MINE-1','Шахта Северная','2026-02-10',2,'Горизонт -320м','BLK-N-101','Магнетит',115.2,31.8,4.5,'EQ-001','Козлов Д.М.','14:00','22:00','Завершена'),
('PRD-004','MINE-1','Шахта Северная','2026-02-10',2,'Горизонт -400м','BLK-N-201','Гематит',87.3,41.2,3.1,'EQ-002','Иванов П.А.','14:00','22:00','Завершена'),
('PRD-005','MINE-2','Шахта Южная','2026-02-10',1,'Горизонт -280м','BLK-S-101','Магнетит',142.8,29.7,5.1,'EQ-003','Морозов К.Е.','06:00','14:00','Завершена'),
('PRD-006','MINE-2','Шахта Южная','2026-02-10',1,'Горизонт -280м','BLK-S-102','Магнетит',108.5,33.6,4.0,'EQ-006','Волков С.И.','06:00','14:00','Завершена'),
('PRD-007','MINE-2','Шахта Южная','2026-02-10',2,'Горизонт -350м','BLK-S-201','Гематит',95.1,39.8,3.5,'EQ-006','Новиков А.Г.','14:00','22:00','Завершена'),
('PRD-008','MINE-1','Шахта Северная','2026-02-11',1,'Горизонт -320м','BLK-N-101','Магнетит',131.0,33.2,4.0,'EQ-001','Петров И.С.','06:00','14:00','Завершена'),
('PRD-009','MINE-1','Шахта Северная','2026-02-11',1,'Горизонт -400м','BLK-N-201','Гематит',78.4,42.5,2.9,'EQ-002','Сидоров А.В.','06:00','14:00','Завершена'),
('PRD-010','MINE-1','Шахта Северная','2026-02-11',2,'Горизонт -320м','BLK-N-102','Магнетит',0.0,0.0,0.0,'EQ-001','Козлов Д.М.','14:00','18:30','Прервана'),
('PRD-011','MINE-2','Шахта Южная','2026-02-11',1,'Горизонт -280м','BLK-S-101','Магнетит',137.5,30.4,4.8,'EQ-003','Морозов К.Е.','06:00','14:00','Завершена'),
('PRD-012','MINE-2','Шахта Южная','2026-02-11',2,'Горизонт -280м','BLK-S-102','Магнетит',119.3,31.1,4.6,'EQ-006','Волков С.И.','14:00','22:00','Завершена'),
('PRD-013','MINE-1','Шахта Северная','2026-02-12',1,'Горизонт -320м','BLK-N-101','Магнетит',128.6,33.0,4.1,'EQ-001','Петров И.С.','06:00','14:00','Завершена'),
('PRD-014','MINE-1','Шахта Северная','2026-02-12',1,'Горизонт -400м','BLK-N-202','Гематит',91.2,40.7,3.3,'EQ-002','Сидоров А.В.','06:00','14:00','Завершена'),
('PRD-015','MINE-2','Шахта Южная','2026-02-12',1,'Горизонт -350м','BLK-S-201','Гематит',88.9,38.5,3.7,'EQ-006','Новиков А.Г.','06:00','14:00','Завершена');

-- ---------- Простои оборудования ----------
INSERT INTO downtime_events VALUES
('DT-001','EQ-001','Незапланированный','Механическая поломка','2026-02-10 08:45:00','2026-02-10 10:30:00',105,'Перегрев двигателя — замена термостата','Высокая','Петров И.С.'),
('DT-002','EQ-003','Плановое ТО','Техническое обслуживание','2026-02-01 06:00:00','2026-02-15 18:00:00',21600,'Плановое ТО-3 — замена гидронасоса и фильтров','Плановое','Служба ТОиР'),
('DT-003','EQ-007','Незапланированный','Электрическая неисправность','2026-02-08 11:20:00','2026-02-10 16:00:00',3160,'Выход из строя блока управления трансмиссией','Критическая','Волков С.И.'),
('DT-004','EQ-004','Незапланированный','Шина/Ходовая','2026-02-10 14:20:00','2026-02-10 16:45:00',145,'Прокол шины — замена на резервную','Средняя','Козлов Д.М.'),
('DT-005','EQ-006','Незапланированный','Гидравлика','2026-02-11 09:15:00','2026-02-11 11:00:00',105,'Утечка гидравлической жидкости — замена шланга','Средняя','Новиков А.Г.'),
('DT-006','EQ-001','Незапланированный','Механическая поломка','2026-02-11 16:30:00','2026-02-12 02:00:00',570,'Поломка ковша — трещина в сварном шве','Высокая','Козлов Д.М.'),
('DT-007','EQ-011','Плановое ТО','Техническое обслуживание','2026-01-20 00:00:00','2026-01-21 18:00:00',2520,'Плановая проверка канатов и тормозной системы','Плановое','Служба ТОиР'),
('DT-008','EQ-005','Незапланированный','Датчики/Электроника','2026-02-10 10:00:00','2026-02-10 11:30:00',90,'Сбой навигационного модуля — перезагрузка системы','Низкая','Иванов П.А.'),
('DT-009','EQ-002','Незапланированный','Топливная система','2026-02-12 07:30:00','2026-02-12 09:00:00',90,'Засорение топливного фильтра — замена','Средняя','Сидоров А.В.'),
('DT-010','EQ-012','Незапланированный','Механическая поломка','2026-02-09 22:00:00','2026-02-10 08:00:00',600,'Износ направляющих скипа — ремонт','Высокая','Служба ТОиР');

-- Проверяем загрузку
SELECT 'equipment' AS table_name, COUNT(*) AS row_count FROM equipment
UNION ALL
SELECT 'sensor_readings', COUNT(*) FROM sensor_readings
UNION ALL
SELECT 'ore_production', COUNT(*) FROM ore_production
UNION ALL
SELECT 'downtime_events', COUNT(*) FROM downtime_events;
