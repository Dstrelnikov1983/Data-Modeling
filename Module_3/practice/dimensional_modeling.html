<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Модуль 3. Dimensional Modeling — детальная презентация</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.6.1/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.6.1/dist/theme/white.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.6.1/plugin/highlight/monokai.css">
    <style>
        :root {
            --accent1: #4472C4;
            --accent2: #ED7D31;
            --accent6: #70AD47;
            --bg-light: #f8f9fa;
            --text-dark: #2c3e50;
            --text-muted: #6c757d;
        }
        .reveal { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 28px; color: var(--text-dark); }
        .reveal h1 { color: var(--accent1); font-size: 1.8em; font-weight: 700; margin-bottom: 0.3em; }
        .reveal h2 { color: var(--accent1); font-size: 1.4em; font-weight: 600; margin-bottom: 0.3em; }
        .reveal h3 { color: var(--accent2); font-size: 1.1em; font-weight: 600; }
        .reveal .slide-number { font-size: 14px; color: var(--accent1); }
        .title-slide { text-align: center; }
        .title-slide h1 { font-size: 2em; border-bottom: 4px solid var(--accent2); display: inline-block; padding-bottom: 10px; }
        .title-slide .subtitle { color: var(--text-muted); font-size: 0.9em; margin-top: 20px; }
        .title-slide .module-info { background: linear-gradient(135deg, var(--accent1), #5a8fd4); color: white; padding: 15px 30px; border-radius: 8px; display: inline-block; margin-top: 20px; font-size: 0.8em; }
        .section-divider { background: linear-gradient(135deg, var(--accent1), #2c5aa0) !important; color: white !important; }
        .section-divider h1, .section-divider h2 { color: white !important; }
        .section-divider .divider-line { width: 100px; height: 4px; background: var(--accent2); margin: 20px auto; }
        .card-container { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin-top: 15px; }
        .card { background: white; border-radius: 8px; padding: 15px 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); flex: 1; min-width: 200px; max-width: 300px; text-align: left; font-size: 0.7em; border-top: 3px solid var(--accent1); }
        .card.accent2 { border-top-color: var(--accent2); }
        .card.accent6 { border-top-color: var(--accent6); }
        .card h4 { color: var(--accent1); margin: 0 0 8px 0; font-size: 1.1em; }
        .card.accent2 h4 { color: var(--accent2); }
        .card.accent6 h4 { color: var(--accent6); }
        .reveal ul { list-style: none; padding-left: 0; }
        .reveal ul li { padding: 4px 0 4px 25px; position: relative; font-size: 0.85em; }
        .reveal ul li::before { content: '\25B8'; color: var(--accent2); position: absolute; left: 5px; font-weight: bold; }
        .reveal ol { padding-left: 30px; }
        .reveal ol li { padding: 4px 0; font-size: 0.85em; }
        .highlight-box { background: linear-gradient(135deg, #e8f0fe, #d4e4fc); border-left: 4px solid var(--accent1); padding: 15px 20px; border-radius: 0 8px 8px 0; margin: 15px 0; font-size: 0.8em; text-align: left; }
        .highlight-box.warning { background: linear-gradient(135deg, #fef3e8, #fde4c8); border-left-color: var(--accent2); }
        .highlight-box.success { background: linear-gradient(135deg, #e8feef, #c8fdd8); border-left-color: var(--accent6); }
        .quiz-container { background: #f8f9fa; border-radius: 12px; padding: 20px; margin: 15px 0; border: 2px solid var(--accent1); }
        .quiz-container h3 { color: var(--accent1); margin-top: 0; }
        .quiz-option { background: white; border: 2px solid #dee2e6; border-radius: 8px; padding: 10px 15px; margin: 8px 0; cursor: pointer; transition: all 0.3s ease; font-size: 0.75em; text-align: left; }
        .quiz-option:hover { border-color: var(--accent1); background: #e8f0fe; }
        .quiz-option.correct { border-color: var(--accent6); background: #e8feef; }
        .quiz-option.incorrect { border-color: #dc3545; background: #fee8e8; }
        .quiz-feedback { margin-top: 10px; padding: 10px; border-radius: 6px; font-size: 0.75em; display: none; }
        .discussion { background: linear-gradient(135deg, #fff8e1, #fff3cd) !important; }
        .discussion-icon { font-size: 2em; margin-bottom: 10px; }
        .discussion h2 { color: var(--accent2) !important; }
        .discussion-question { background: white; border-radius: 12px; padding: 20px; margin: 10px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-size: 0.85em; border-left: 4px solid var(--accent2); text-align: left; }
        .practice-slide { background: linear-gradient(135deg, #e8feef, #d4fce4) !important; }
        .practice-slide h2 { color: var(--accent6) !important; }
        .reveal table { border-collapse: collapse; margin: 15px auto; font-size: 0.65em; width: 90%; }
        .reveal table th { background: var(--accent1); color: white; padding: 10px 15px; text-align: left; font-weight: 600; }
        .reveal table td { padding: 8px 15px; border-bottom: 1px solid #dee2e6; text-align: left; }
        .reveal table tr:nth-child(even) { background: #f8f9fa; }
        .reveal table tr:hover { background: #e8f0fe; }
        .flow-container { display: flex; align-items: center; justify-content: center; gap: 5px; flex-wrap: wrap; margin: 15px 0; }
        .flow-step { background: linear-gradient(135deg, var(--accent1), #5a8fd4); color: white; padding: 12px 16px; border-radius: 8px; font-size: 0.6em; font-weight: 600; min-width: 100px; text-align: center; }
        .flow-arrow { color: var(--accent2); font-size: 1.2em; font-weight: bold; }
        .group-work { background: linear-gradient(135deg, #f0e8fe, #e4d4fc) !important; }
        .group-work h2 { color: #7c3aed !important; }
        .group-task { background: white; border-radius: 10px; padding: 15px; margin: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); font-size: 0.7em; text-align: left; }
        .group-task .group-num { display: inline-block; background: #7c3aed; color: white; border-radius: 50%; width: 28px; height: 28px; line-height: 28px; text-align: center; font-weight: bold; margin-right: 8px; }
        .case-study { background: linear-gradient(135deg, #fce8e8, #fcd4d4) !important; }
        .case-study h2 { color: #dc3545 !important; }
        .case-box { background: white; border-radius: 10px; padding: 20px; margin: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-size: 0.75em; text-align: left; }
        .reveal pre { box-shadow: 0 2px 8px rgba(0,0,0,0.15); border-radius: 8px; font-size: 0.5em; }
        .reveal pre code { padding: 15px 20px; max-height: 500px; }
        .badge { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 0.6em; font-weight: 600; color: white; margin: 2px; }
        .badge-blue { background: var(--accent1); }
        .badge-orange { background: var(--accent2); }
        .badge-green { background: var(--accent6); }
        .badge-purple { background: #7c3aed; }
        .badge-red { background: #dc3545; }
        .comparison { display: flex; gap: 15px; margin-top: 15px; }
        .comparison .col { flex: 1; background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); font-size: 0.7em; text-align: left; }
        .progress-bar { height: 4px; background: #dee2e6; border-radius: 2px; margin: 20px 0 5px 0; }
        .progress-bar .fill { height: 100%; border-radius: 2px; background: linear-gradient(90deg, var(--accent1), var(--accent2)); }
        .slide-footer { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 0.45em; color: var(--text-muted); }
        .icon-circle { width: 60px; height: 60px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 1.5em; margin: 5px; }
        .icon-circle.blue { background: #e8f0fe; color: var(--accent1); }
        .icon-circle.orange { background: #fef3e8; color: var(--accent2); }
        .icon-circle.green { background: #e8feef; color: var(--accent6); }
        .reveal .slides section { padding: 20px 40px; }
        .small { font-size: 0.7em; }
        .smaller { font-size: 0.6em; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .mt-10 { margin-top: 10px; }
        .mt-20 { margin-top: 20px; }
        .mb-10 { margin-bottom: 10px; }
        .er-entity { background: white; border: 2px solid var(--accent1); border-radius: 8px; padding: 10px 15px; display: inline-block; font-size: 0.65em; text-align: left; box-shadow: 0 2px 6px rgba(0,0,0,0.1); min-width: 160px; vertical-align: top; }
        .er-entity .entity-title { background: var(--accent1); color: white; padding: 5px 10px; margin: -10px -15px 10px -15px; border-radius: 6px 6px 0 0; font-weight: 600; text-align: center; }
        .er-entity.accent2 { border-color: var(--accent2); }
        .er-entity.accent2 .entity-title { background: var(--accent2); }
        .er-entity.accent6 { border-color: var(--accent6); }
        .er-entity.accent6 .entity-title { background: var(--accent6); }
        .er-entity.purple { border-color: #7c3aed; }
        .er-entity.purple .entity-title { background: #7c3aed; }
        .er-entity.red { border-color: #dc3545; }
        .er-entity.red .entity-title { background: #dc3545; }
        .er-field { padding: 2px 0; font-size: 0.95em; }
        .er-field .pk { color: var(--accent2); font-weight: bold; }
        .er-field .fk { color: #7c3aed; font-weight: bold; }
        .er-field .metric { color: var(--accent6); font-weight: bold; }
        .tables-row { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 10px; }
        .tables-row .er-entity { flex: 0 1 auto; }
        /* Star layout (5-col grid with arrow cells) */
        .star-layout { display: grid; grid-template-columns: 1fr 30px 1fr 30px 1fr; grid-template-rows: auto 22px auto 22px auto; gap: 4px; justify-items: center; align-items: center; margin: 10px auto; max-width: 960px; }
        .star-center { grid-column: 3; grid-row: 3; }
        .star-top { grid-column: 3; grid-row: 1; }
        .star-left { grid-column: 1; grid-row: 3; }
        .star-right { grid-column: 5; grid-row: 3; }
        .star-bl { grid-column: 1; grid-row: 5; }
        .star-br { grid-column: 5; grid-row: 5; }
        .star-bottom { grid-column: 3; grid-row: 5; }
        /* Star connectors */
        .star-conn { display: flex; align-items: center; justify-content: center; font-size: 0.5em; font-weight: 700; color: var(--accent1); gap: 2px; }
        .star-conn.vert { flex-direction: column; }
        .star-conn .conn-h { width: 100%; height: 2px; background: var(--accent1); min-width: 12px; }
        .star-conn .conn-v { width: 2px; height: 100%; background: var(--accent1); min-height: 8px; }
        .star-conn-top { grid-column: 3; grid-row: 2; }
        .star-conn-left { grid-column: 2; grid-row: 3; }
        .star-conn-right { grid-column: 4; grid-row: 3; }
        .star-conn-bottom { grid-column: 3; grid-row: 4; }
        .star-conn-left-bl { grid-column: 1; grid-row: 4; }
        .star-conn-right-br { grid-column: 5; grid-row: 4; }
        /* ER link arrows for tables-row */
        .er-link { display: flex; align-items: center; justify-content: center; flex: 0 0 auto; padding: 10px 0; white-space: nowrap; }
        .er-link-inner { display: flex; align-items: center; gap: 0; font-size: 0.6em; font-weight: 700; color: var(--accent1); }
        .er-link-inner .card-label { padding: 0 3px; }
        .er-link-inner .link-line { width: 24px; height: 2px; background: var(--accent1); }
        .er-link-inner .link-arrow-r::after { content: '\25B6'; font-size: 0.8em; }
        .er-link-inner .link-arrow-l::before { content: '\25C0'; font-size: 0.8em; }
        /* Industry color */
        .industry-retail { border-top: 3px solid #e91e63; }
        .industry-retail h4 { color: #e91e63; }
        .industry-finance { border-top: 3px solid #9c27b0; }
        .industry-finance h4 { color: #9c27b0; }
        .industry-telecom { border-top: 3px solid #00bcd4; }
        .industry-telecom h4 { color: #00bcd4; }
        .industry-transport { border-top: 3px solid #ff9800; }
        .industry-transport h4 { color: #ff9800; }
        .industry-mfg { border-top: 3px solid #607d8b; }
        .industry-mfg h4 { color: #607d8b; }
    </style>
</head>
<body>
<div class="reveal">
<div class="slides">

<!-- ====== TITLE ====== -->
<section class="title-slide">
    <h1>Dimensional Modeling</h1>
    <p class="subtitle">Подход Ральфа Кимбалла к проектированию<br>аналитических хранилищ данных</p>
    <div class="module-info">
        Модуль 3 &bull; Тема 3.2–3.3 &bull; Предприятие &laquo;Руда+&raquo; и отраслевые примеры
    </div>
</section>

<!-- ====== СОДЕРЖАНИЕ ====== -->
<section>
    <h2>Содержание</h2>
    <table style="width:95%;">
        <thead><tr><th>#</th><th>Раздел</th><th>Слайды</th></tr></thead>
        <tbody>
            <tr><td>1</td><td>Философия Dimensional Modeling</td><td>Принципы, 4 шага Кимбалла</td></tr>
            <tr><td>2</td><td>Факты: типы и гранулярность</td><td>Transaction, Periodic Snapshot, Accumulating</td></tr>
            <tr><td>3</td><td>Измерения: типы и паттерны</td><td>SCD, Junk, Degenerate, Role-playing, Outrigger</td></tr>
            <tr><td>4</td><td>Схема &laquo;Звезда&raquo; (Star Schema)</td><td>Структура, SQL-примеры, &laquo;Руда+&raquo;</td></tr>
            <tr><td>5</td><td>Схема &laquo;Снежинка&raquo; (Snowflake Schema)</td><td>Структура, сравнение, когда применять</td></tr>
            <tr><td>6</td><td>Отраслевые модели</td><td>Торговля, Финансы, Телеком, Транспорт, Промышленность</td></tr>
            <tr><td>7</td><td>Квизы и обсуждение</td><td>Вопросы, групповая работа</td></tr>
        </tbody>
    </table>
</section>

<!-- ============================== -->
<!-- РАЗДЕЛ 1: ФИЛОСОФИЯ           -->
<!-- ============================== -->
<section class="section-divider">
    <h1>1. Философия Dimensional Modeling</h1>
    <div class="divider-line"></div>
    <p style="font-size:0.9em;">Подход Ральфа Кимбалла &laquo;снизу вверх&raquo;</p>
</section>

<section>
    <h2>Ральф Кимбалл: ключевые принципы</h2>
    <div class="card-container">
        <div class="card">
            <h4>Bottom-Up</h4>
            <p>Начинаем с конкретных бизнес-процессов, а не с корпоративной модели. Каждый процесс &mdash; отдельный Data Mart.</p>
        </div>
        <div class="card accent2">
            <h4>Bus Architecture</h4>
            <p>Data Marts связаны через <strong>Conformed Dimensions</strong> &mdash; общие измерения, одинаковые по структуре и значениям.</p>
        </div>
        <div class="card accent6">
            <h4>Простота запросов</h4>
            <p>Модель должна быть понятна бизнес-пользователю. Минимум JOIN, читаемые имена, предсказуемая структура.</p>
        </div>
    </div>
    <div class="highlight-box mt-20">
        <strong>Главная цель:</strong> Преобразовать данные из формы, удобной для <em>записи</em> (OLTP, 3НФ), в форму, удобную для <em>чтения и анализа</em> (Dimensional Model).
    </div>
</section>

<section>
    <h2>4 шага проектирования по Кимбаллу</h2>
    <div class="flow-container">
        <div class="flow-step" style="min-width:160px;">1. Выбрать<br>бизнес-процесс</div>
        <div class="flow-arrow">&rarr;</div>
        <div class="flow-step" style="min-width:160px; background:linear-gradient(135deg,var(--accent2),#d4692a);">2. Определить<br>гранулярность</div>
        <div class="flow-arrow">&rarr;</div>
        <div class="flow-step" style="min-width:160px; background:linear-gradient(135deg,var(--accent6),#5a9a3a);">3. Определить<br>измерения</div>
        <div class="flow-arrow">&rarr;</div>
        <div class="flow-step" style="min-width:160px; background:linear-gradient(135deg,#7c3aed,#5a2db8);">4. Определить<br>факты (метрики)</div>
    </div>
    <div class="comparison mt-20">
        <div class="col" style="border-top:3px solid var(--accent1);">
            <strong>Пример &laquo;Руда+&raquo;</strong><br><br>
            <strong>1.</strong> Процесс: <em>Добыча руды</em><br>
            <strong>2.</strong> Зерно: <em>одна смена / одна единица оборудования / один оператор</em><br>
            <strong>3.</strong> Измерения: <em>Время, Шахта, Оборудование, Оператор</em><br>
            <strong>4.</strong> Факты: <em>тоннаж, содержание Fe%, влажность%</em>
        </div>
        <div class="col" style="border-top:3px solid var(--accent2);">
            <strong>Пример Торговля</strong><br><br>
            <strong>1.</strong> Процесс: <em>Продажа товара</em><br>
            <strong>2.</strong> Зерно: <em>одна строка чека (line item)</em><br>
            <strong>3.</strong> Измерения: <em>Дата, Магазин, Товар, Промоакция</em><br>
            <strong>4.</strong> Факты: <em>количество, сумма, скидка, себестоимость</em>
        </div>
    </div>
</section>

<section>
    <h2>Conformed Dimensions &mdash; единый язык</h2>
    <div class="highlight-box warning">
        <strong>Conformed Dimension</strong> &mdash; измерение, которое используется одинаково в нескольких Data Mart. Один и тот же dim_time, dim_mine, dim_equipment &mdash; во всех витринах.
    </div>
    <div class="text-center mt-10">
        <div style="display:inline-flex; gap:10px; flex-wrap:wrap; justify-content:center;">
            <div class="er-entity accent2" style="min-width:160px;">
                <div class="entity-title">fact_production</div>
                <div class="er-field"><span class="fk">FK</span> time_key</div>
                <div class="er-field"><span class="fk">FK</span> mine_key</div>
                <div class="er-field"><span class="fk">FK</span> equipment_key</div>
                <div class="er-field"><span class="metric">M</span> tonnage</div>
            </div>
            <div class="er-link"><div class="er-link-inner"><span class="card-label">N</span><span class="link-arrow-r"></span><span class="link-line"></span><span class="card-label">1</span></div></div>
            <div class="er-entity" style="min-width:130px;">
                <div class="entity-title">dim_time</div>
                <div class="er-field"><span class="pk">PK</span> time_key</div>
                <div class="er-field">date, month</div>
                <div class="er-field">quarter, year</div>
                <div class="er-field">shift</div>
            </div>
            <div class="er-link"><div class="er-link-inner"><span class="card-label">1</span><span class="link-line"></span><span class="link-arrow-l"></span><span class="card-label">N</span></div></div>
            <div class="er-entity accent2" style="min-width:160px;">
                <div class="entity-title">fact_downtime</div>
                <div class="er-field"><span class="fk">FK</span> time_key</div>
                <div class="er-field"><span class="fk">FK</span> equipment_key</div>
                <div class="er-field"><span class="fk">FK</span> category_key</div>
                <div class="er-field"><span class="metric">M</span> duration_min</div>
            </div>
        </div>
    </div>
    <div class="highlight-box success mt-10">
        dim_time и dim_equipment &mdash; общие для обоих фактов. Это позволяет строить <strong>drill-across</strong> запросы: &laquo;Как соотносится добыча и простои по месяцам?&raquo;
    </div>
</section>

<!-- ============================== -->
<!-- РАЗДЕЛ 2: ТИПЫ ФАКТОВ         -->
<!-- ============================== -->
<section class="section-divider">
    <h1>2. Типы таблиц фактов</h1>
    <div class="divider-line"></div>
    <p style="font-size:0.9em;">Transaction, Periodic Snapshot, Accumulating Snapshot</p>
</section>

<section>
    <h2>Три типа таблиц фактов</h2>
    <div class="card-container">
        <div class="card">
            <h4>Transaction Fact</h4>
            <p><strong>Одна строка = одно событие.</strong> Самый детальный. Строки только добавляются.</p>
            <p class="smaller"><em>&laquo;Руда+&raquo;:</em> каждый рейс самосвала, каждое показание датчика</p>
        </div>
        <div class="card accent2">
            <h4>Periodic Snapshot</h4>
            <p><strong>Одна строка = состояние за период.</strong> Фиксированные интервалы (день, месяц). Строки добавляются регулярно.</p>
            <p class="smaller"><em>&laquo;Руда+&raquo;:</em> суточная сводка добычи по шахте, месячный KPI</p>
        </div>
        <div class="card accent6">
            <h4>Accumulating Snapshot</h4>
            <p><strong>Одна строка = весь жизненный цикл процесса.</strong> Строки обновляются по мере прохождения этапов.</p>
            <p class="smaller"><em>&laquo;Руда+&raquo;:</em> заявка на ремонт: создана &rarr; согласована &rarr; выполнена &rarr; закрыта</p>
        </div>
    </div>
</section>

<section>
    <h2>Гранулярность: выбор зерна</h2>
    <div class="highlight-box warning">
        <strong>Grain (зерно)</strong> &mdash; что описывает одна строка таблицы фактов. Это самое важное решение при проектировании!
    </div>
    <table class="mt-10">
        <thead><tr><th>Зерно</th><th>Пример &laquo;Руда+&raquo;</th><th>Строк/год</th><th>Применение</th></tr></thead>
        <tbody>
            <tr><td>Показание датчика</td><td>1 значение, 1 датчик, 1 секунда</td><td>~31 млрд</td><td>IoT-аналитика, ML</td></tr>
            <tr><td>Рейс самосвала</td><td>1 рейс, 1 самосвал, 1 маршрут</td><td>~50 000</td><td>Логистика, OEE</td></tr>
            <tr><td>Смена</td><td>1 оператор, 1 оборудование, 1 смена</td><td>~3 000</td><td>Производительность</td></tr>
            <tr><td>Сутки по шахте</td><td>1 шахта, 1 день</td><td>~1 100</td><td>Отчётность</td></tr>
        </tbody>
    </table>
    <div class="highlight-box success mt-10">
        <strong>Правило Кимбалла:</strong> Выбирайте самое детальное зерно, которое поддерживает все бизнес-вопросы. Агрегировать &mdash; можно, дезагрегировать &mdash; нельзя!
    </div>
</section>

<section>
    <h2>Типы метрик (facts)</h2>
    <table>
        <thead><tr><th>Тип</th><th>Описание</th><th>Пример &laquo;Руда+&raquo;</th><th>Можно ли суммировать?</th></tr></thead>
        <tbody>
            <tr><td><span class="badge badge-green">Additive</span></td><td>Суммируются по всем измерениям</td><td>тоннаж, длительность простоя</td><td>Да, по всем</td></tr>
            <tr><td><span class="badge badge-orange">Semi-additive</span></td><td>Суммируются не по всем измерениям</td><td>остаток топлива (нельзя суммировать по времени)</td><td>Нет по времени</td></tr>
            <tr><td><span class="badge badge-red">Non-additive</span></td><td>Нельзя суммировать</td><td>содержание Fe%, температура</td><td>Нет (только AVG, MIN, MAX)</td></tr>
        </tbody>
    </table>
    <div class="highlight-box mt-10">
        <strong>Практический совет:</strong> В таблице фактов храните <em>исходные</em> аддитивные метрики (количество и цену), а не производные (итого = кол-во * цена). Производные вычисляются в запросе.
    </div>
</section>

<!-- ============================== -->
<!-- РАЗДЕЛ 3: ТИПЫ ИЗМЕРЕНИЙ      -->
<!-- ============================== -->
<section class="section-divider">
    <h1>3. Типы измерений и паттерны</h1>
    <div class="divider-line"></div>
    <p style="font-size:0.9em;">SCD, Junk, Degenerate, Role-Playing, Outrigger</p>
</section>

<section>
    <h2>Slowly Changing Dimensions (SCD)</h2>
    <table>
        <thead><tr><th>Тип SCD</th><th>Стратегия</th><th>История</th><th>Пример &laquo;Руда+&raquo;</th></tr></thead>
        <tbody>
            <tr><td><span class="badge badge-blue">Type 0</span></td><td>Не менять (retain original)</td><td>Нет</td><td>Дата ввода оборудования в эксплуатацию</td></tr>
            <tr><td><span class="badge badge-orange">Type 1</span></td><td>Перезаписать</td><td>Нет</td><td>Исправление опечатки в названии шахты</td></tr>
            <tr><td><span class="badge badge-green">Type 2</span></td><td>Новая строка + даты valid_from/to</td><td>Полная</td><td>Смена разряда оператора, перевод в другую шахту</td></tr>
            <tr><td><span class="badge badge-purple">Type 3</span></td><td>Дополнительный столбец (prev_value)</td><td>Частичная</td><td>Предыдущий цех механика</td></tr>
            <tr><td><span class="badge badge-red">Type 6</span></td><td>Комбинация: 1+2+3</td><td>Полная + текущее</td><td>Оператор: полная история + текущий разряд</td></tr>
        </tbody>
    </table>
</section>

<section>
    <h2>SCD Type 2: пример для &laquo;Руда+&raquo;</h2>
    <pre><code class="language-sql">CREATE TABLE dim_operator (
    operator_key    SERIAL PRIMARY KEY,   -- суррогатный ключ
    operator_id     VARCHAR(10) NOT NULL,  -- бизнес-ключ (натуральный)
    full_name       VARCHAR(100),
    position        VARCHAR(50),
    qualification   INT,
    mine_name       VARCHAR(50),
    -- SCD Type 2 поля:
    valid_from      DATE NOT NULL,
    valid_to        DATE DEFAULT '9999-12-31',
    is_current      BOOLEAN DEFAULT TRUE
);

-- Оператор Иванов А.А. повысил разряд с 5 до 6:
-- Шаг 1: «закрыть» текущую запись
UPDATE dim_operator
SET valid_to = '2025-03-14', is_current = FALSE
WHERE operator_id = 'OP001' AND is_current = TRUE;

-- Шаг 2: вставить новую версию
INSERT INTO dim_operator (operator_id, full_name, position, qualification,
                          mine_name, valid_from, valid_to, is_current)
VALUES ('OP001', 'Иванов А.А.', 'Машинист ПДМ', 6,
        'Северная', '2025-03-15', '9999-12-31', TRUE);</code></pre>
</section>

<section>
    <h2>Специальные типы измерений</h2>
    <div class="card-container">
        <div class="card">
            <h4>Degenerate Dimension</h4>
            <p>Ключ измерения без отдельной таблицы. Хранится прямо в таблице фактов.</p>
            <p class="smaller"><em>Примеры:</em> номер чека, номер заказа, id рейса</p>
        </div>
        <div class="card accent2">
            <h4>Junk Dimension</h4>
            <p>Объединение нескольких флагов/индикаторов в одну таблицу. Уменьшает число измерений.</p>
            <p class="smaller"><em>&laquo;Руда+&raquo;:</em> dim_downtime_flags (плановый/внеплановый, критичный/некритичный)</p>
        </div>
        <div class="card accent6">
            <h4>Role-Playing Dimension</h4>
            <p>Одна физическая таблица, используемая в нескольких ролях через VIEW или алиасы.</p>
            <p class="smaller"><em>Примеры:</em> dim_date как &laquo;дата заказа&raquo;, &laquo;дата отгрузки&raquo;, &laquo;дата оплаты&raquo;</p>
        </div>
    </div>
    <div class="card-container mt-10">
        <div class="card" style="border-top-color:#7c3aed;">
            <h4 style="color:#7c3aed;">Outrigger Dimension</h4>
            <p>Измерение, ссылающееся на другое измерение. Допустимо, когда подтаблица очень велика.</p>
            <p class="smaller"><em>Пример:</em> dim_equipment &rarr; dim_manufacturer (если производителей тысячи)</p>
        </div>
        <div class="card" style="border-top-color:#dc3545;">
            <h4 style="color:#dc3545;">Mini-Dimension</h4>
            <p>Выделение быстро меняющихся атрибутов из большого измерения в отдельную таблицу.</p>
            <p class="smaller"><em>Пример:</em> dim_customer_demographics (возрастная группа, доходная группа)</p>
        </div>
    </div>
</section>

<!-- ============================== -->
<!-- РАЗДЕЛ 4: ЗВЕЗДА               -->
<!-- ============================== -->
<section class="section-divider">
    <h1>4. Схема &laquo;Звезда&raquo;</h1>
    <div class="divider-line"></div>
    <p style="font-size:0.9em;">Star Schema &mdash; основа Dimensional Modeling</p>
</section>

<section>
    <h2>Star Schema: структура</h2>
    <div class="highlight-box">
        Таблица фактов в центре, измерения вокруг. Каждое измерение соединяется с фактом <strong>одним JOIN</strong>. Измерения <strong>денормализованы</strong> (широкие, плоские таблицы).
    </div>
    <div class="star-layout mt-10">
        <div class="er-entity star-top" style="min-width:140px;">
            <div class="entity-title">dim_time</div>
            <div class="er-field"><span class="pk">PK</span> time_key</div>
            <div class="er-field">production_date</div>
            <div class="er-field">year, quarter, month</div>
            <div class="er-field">day_of_week, shift</div>
        </div>
        <div class="er-entity star-left" style="min-width:140px;">
            <div class="entity-title" style="background:var(--accent6);">dim_mine</div>
            <div class="er-field"><span class="pk">PK</span> mine_key</div>
            <div class="er-field">mine_name</div>
            <div class="er-field">region, city</div>
            <div class="er-field">max_depth_m</div>
            <div class="er-field">status</div>
        </div>
        <div class="er-entity accent2 star-center" style="min-width:190px;">
            <div class="entity-title">fact_production</div>
            <div class="er-field"><span class="fk">FK</span> time_key</div>
            <div class="er-field"><span class="fk">FK</span> mine_key</div>
            <div class="er-field"><span class="fk">FK</span> equipment_key</div>
            <div class="er-field"><span class="fk">FK</span> operator_key</div>
            <div class="er-field"><span class="metric">M</span> tonnage_extracted</div>
            <div class="er-field"><span class="metric">M</span> fe_content_pct</div>
            <div class="er-field"><span class="metric">M</span> moisture_pct</div>
            <div class="er-field"><span class="metric">M</span> trips_count</div>
        </div>
        <div class="er-entity star-right" style="min-width:150px;">
            <div class="entity-title" style="background:#dc3545;">dim_equipment</div>
            <div class="er-field"><span class="pk">PK</span> equipment_key</div>
            <div class="er-field">equipment_name</div>
            <div class="er-field">type_name</div>
            <div class="er-field">manufacturer</div>
            <div class="er-field">year_of_production</div>
            <div class="er-field">mine_name</div>
        </div>
        <div class="er-entity star-bottom" style="min-width:150px;">
            <div class="entity-title" style="background:#7c3aed;">dim_operator</div>
            <div class="er-field"><span class="pk">PK</span> operator_key</div>
            <div class="er-field">full_name</div>
            <div class="er-field">position</div>
            <div class="er-field">qualification</div>
            <div class="er-field">mine_name</div>
        </div>
        <div class="star-conn star-conn-top vert"><span>1</span><span class="conn-v"></span><span>N</span></div>
        <div class="star-conn star-conn-left"><span>1</span><span class="conn-h"></span><span>N</span></div>
        <div class="star-conn star-conn-right"><span>N</span><span class="conn-h"></span><span>1</span></div>
        <div class="star-conn star-conn-bottom vert"><span>N</span><span class="conn-v"></span><span>1</span></div>
    </div>
</section>

<section>
    <h2>Star Schema: SQL-запрос &laquo;Руда+&raquo;</h2>
    <pre><code class="language-sql">-- Добыча по шахтам и кварталам с качеством руды
SELECT
    m.mine_name                        AS шахта,
    t.year                             AS год,
    t.quarter                          AS квартал,
    SUM(f.tonnage_extracted)           AS всего_тонн,
    ROUND(AVG(f.fe_content_pct), 2)    AS средн_Fe_процент,
    COUNT(DISTINCT f.operator_key)     AS операторов
FROM fact_production f
JOIN dim_time      t ON f.time_key      = t.time_key
JOIN dim_mine      m ON f.mine_key      = m.mine_key
WHERE t.year = 2025
GROUP BY m.mine_name, t.year, t.quarter
ORDER BY m.mine_name, t.quarter;</code></pre>
    <div class="highlight-box success mt-10">
        <strong>Обратите внимание:</strong> Всего 2 JOIN для ответа на сложный бизнес-вопрос. В 3НФ потребовалось бы 5–7 JOIN. Это главное преимущество звёздной схемы.
    </div>
</section>

<section>
    <h2>Преимущества Star Schema</h2>
    <div class="card-container">
        <div class="card">
            <h4>Производительность</h4>
            <p>Меньше JOIN &rarr; быстрее запросы. Оптимизаторы СУБД хорошо работают со звёздными схемами (Star Join Optimization).</p>
        </div>
        <div class="card accent2">
            <h4>Простота</h4>
            <p>Бизнес-пользователи легко понимают структуру. BI-инструменты (Tableau, Power BI, Superset) автоматически распознают звезду.</p>
        </div>
        <div class="card accent6">
            <h4>Расширяемость</h4>
            <p>Новое измерение = новая таблица + FK в факт. Новая метрика = новый столбец в факте. Без перестройки всей схемы.</p>
        </div>
    </div>
</section>

<!-- ============================== -->
<!-- РАЗДЕЛ 5: СНЕЖИНКА             -->
<!-- ============================== -->
<section class="section-divider">
    <h1>5. Схема &laquo;Снежинка&raquo;</h1>
    <div class="divider-line"></div>
    <p style="font-size:0.9em;">Snowflake Schema &mdash; нормализованные измерения</p>
</section>

<section>
    <h2>Snowflake Schema: структура</h2>
    <div class="highlight-box">
        Снежинка &mdash; это звезда, в которой <strong>измерения нормализованы</strong>. Каждая иерархия вынесена в отдельную таблицу. Факт соединяется с &laquo;первым уровнем&raquo;, а тот &mdash; со следующими.
    </div>
    <div class="star-layout mt-10">
        <div class="er-entity star-top" style="min-width:120px;">
            <div class="entity-title">dim_date</div>
            <div class="er-field"><span class="pk">PK</span> date_key</div>
            <div class="er-field">full_date</div>
            <div class="er-field"><span class="fk">FK</span> month_key</div>
            <div class="er-field">day_of_week</div>
        </div>
        <div class="er-entity purple star-left" style="min-width:110px;">
            <div class="entity-title">dim_month</div>
            <div class="er-field"><span class="pk">PK</span> month_key</div>
            <div class="er-field">month_name</div>
            <div class="er-field"><span class="fk">FK</span> quarter_key</div>
        </div>
        <div class="er-entity accent2 star-center" style="min-width:180px;">
            <div class="entity-title">fact_production</div>
            <div class="er-field"><span class="fk">FK</span> date_key</div>
            <div class="er-field"><span class="fk">FK</span> equipment_key</div>
            <div class="er-field"><span class="fk">FK</span> mine_key</div>
            <div class="er-field"><span class="metric">M</span> tonnage</div>
            <div class="er-field"><span class="metric">M</span> fe_pct</div>
        </div>
        <div class="er-entity star-right" style="min-width:130px;">
            <div class="entity-title" style="background:var(--accent6);">dim_equipment</div>
            <div class="er-field"><span class="pk">PK</span> eq_key</div>
            <div class="er-field">eq_name</div>
            <div class="er-field"><span class="fk">FK</span> type_key</div>
            <div class="er-field"><span class="fk">FK</span> mfr_key</div>
        </div>
        <div class="er-entity purple star-bl" style="min-width:110px;">
            <div class="entity-title">dim_quarter</div>
            <div class="er-field"><span class="pk">PK</span> quarter_key</div>
            <div class="er-field">quarter_name</div>
            <div class="er-field"><span class="fk">FK</span> year_key</div>
        </div>
        <div class="er-entity star-br" style="min-width:120px;">
            <div class="entity-title" style="background:#dc3545;">dim_eq_type</div>
            <div class="er-field"><span class="pk">PK</span> type_key</div>
            <div class="er-field">type_name</div>
        </div>
        <div class="star-conn star-conn-top vert"><span>1</span><span class="conn-v"></span><span>N</span></div>
        <div class="star-conn star-conn-right"><span>N</span><span class="conn-h"></span><span>1</span></div>
        <div class="star-conn star-conn-left-bl vert"><span>N</span><span class="conn-v"></span><span>1</span></div>
        <div class="star-conn star-conn-right-br vert"><span>N</span><span class="conn-v"></span><span>1</span></div>
    </div>
</section>

<section>
    <h2>Звезда vs Снежинка: сравнение</h2>
    <table style="width:95%;">
        <thead><tr><th>Критерий</th><th>Звезда (Star)</th><th>Снежинка (Snowflake)</th></tr></thead>
        <tbody>
            <tr><td>Измерения</td><td>Денормализованы (широкие)</td><td>Нормализованы (3НФ)</td></tr>
            <tr><td>Кол-во таблиц</td><td>Меньше</td><td>Больше</td></tr>
            <tr><td>Кол-во JOIN</td><td>N (по числу измерений)</td><td>N + иерархии</td></tr>
            <tr><td>Место на диске</td><td>Больше (дублирование)</td><td>Меньше</td></tr>
            <tr><td>Производительность</td><td>Быстрее (меньше JOIN)</td><td>Медленнее</td></tr>
            <tr><td>Простота SQL</td><td>Проще</td><td>Сложнее</td></tr>
            <tr><td>BI-инструменты</td><td>Нативная поддержка</td><td>Поддержка слабее</td></tr>
            <tr><td>Когда применять</td><td>В большинстве случаев</td><td>Очень большие измерения (&gt;1М строк)</td></tr>
        </tbody>
    </table>
    <div class="highlight-box success mt-10">
        <strong>Рекомендация Кимбалла:</strong> Используйте звезду по умолчанию. Снежинка оправдана только при гигантских измерениях или жёстких требованиях к экономии хранилища.
    </div>
</section>

<section>
    <h2>Snowflake: SQL-запрос для сравнения</h2>
    <div class="comparison">
        <div class="col" style="border-top:3px solid var(--accent6);">
            <strong style="color:var(--accent6);">Star Schema (2 JOIN)</strong>
            <pre style="font-size:0.85em;"><code class="language-sql">SELECT
  e.type_name,
  SUM(f.tonnage)
FROM fact_production f
JOIN dim_equipment e
  ON f.equipment_key = e.equipment_key
GROUP BY e.type_name;</code></pre>
        </div>
        <div class="col" style="border-top:3px solid var(--accent2);">
            <strong style="color:var(--accent2);">Snowflake Schema (3 JOIN)</strong>
            <pre style="font-size:0.85em;"><code class="language-sql">SELECT
  t.type_name,
  SUM(f.tonnage)
FROM fact_production f
JOIN dim_equipment e
  ON f.equipment_key = e.eq_key
JOIN dim_eq_type t
  ON e.type_key = t.type_key
GROUP BY t.type_name;</code></pre>
        </div>
    </div>
    <div class="highlight-box warning mt-10">
        В данном примере разница невелика, но при 5–6 уровнях иерархии и миллионах строк дополнительные JOIN ощутимо влияют на производительность.
    </div>
</section>

<!-- ============================== -->
<!-- РАЗДЕЛ 6: ОТРАСЛЕВЫЕ МОДЕЛИ   -->
<!-- ============================== -->
<section class="section-divider">
    <h1>6. Отраслевые модели данных</h1>
    <div class="divider-line"></div>
    <p style="font-size:0.9em;">Торговля &bull; Финансы &bull; Телеком &bull; Транспорт &bull; Промышленность</p>
</section>

<!-- ТОРГОВЛЯ -->
<section>
    <h2>Торговля (Retail) &mdash; схема &laquo;Звезда&raquo;</h2>
    <div class="star-layout">
        <div class="er-entity star-top" style="min-width:130px;">
            <div class="entity-title">dim_date</div>
            <div class="er-field"><span class="pk">PK</span> date_key</div>
            <div class="er-field">full_date</div>
            <div class="er-field">day_of_week</div>
            <div class="er-field">month, quarter</div>
            <div class="er-field">year, is_holiday</div>
        </div>
        <div class="er-entity star-left" style="min-width:130px;">
            <div class="entity-title" style="background:#e91e63;">dim_store</div>
            <div class="er-field"><span class="pk">PK</span> store_key</div>
            <div class="er-field">store_name</div>
            <div class="er-field">city, region</div>
            <div class="er-field">format (гипер/супер)</div>
            <div class="er-field">square_m</div>
        </div>
        <div class="er-entity accent2 star-center" style="min-width:180px;">
            <div class="entity-title">fact_sales</div>
            <div class="er-field"><span class="fk">FK</span> date_key</div>
            <div class="er-field"><span class="fk">FK</span> store_key</div>
            <div class="er-field"><span class="fk">FK</span> product_key</div>
            <div class="er-field"><span class="fk">FK</span> promo_key</div>
            <div class="er-field">receipt_number (DD)</div>
            <div class="er-field"><span class="metric">M</span> quantity</div>
            <div class="er-field"><span class="metric">M</span> sales_amount</div>
            <div class="er-field"><span class="metric">M</span> discount</div>
            <div class="er-field"><span class="metric">M</span> cost_amount</div>
        </div>
        <div class="er-entity star-right" style="min-width:140px;">
            <div class="entity-title" style="background:var(--accent6);">dim_product</div>
            <div class="er-field"><span class="pk">PK</span> product_key</div>
            <div class="er-field">product_name</div>
            <div class="er-field">brand, category</div>
            <div class="er-field">subcategory</div>
            <div class="er-field">supplier</div>
            <div class="er-field">unit_price</div>
        </div>
        <div class="er-entity star-bottom" style="min-width:140px;">
            <div class="entity-title" style="background:#7c3aed;">dim_promotion</div>
            <div class="er-field"><span class="pk">PK</span> promo_key</div>
            <div class="er-field">promo_name</div>
            <div class="er-field">promo_type</div>
            <div class="er-field">discount_pct</div>
            <div class="er-field">start_date, end_date</div>
        </div>
        <div class="star-conn star-conn-top vert"><span>1</span><span class="conn-v"></span><span>N</span></div>
        <div class="star-conn star-conn-left"><span>1</span><span class="conn-h"></span><span>N</span></div>
        <div class="star-conn star-conn-right"><span>N</span><span class="conn-h"></span><span>1</span></div>
        <div class="star-conn star-conn-bottom vert"><span>N</span><span class="conn-v"></span><span>1</span></div>
    </div>
    <div class="smaller text-center mt-10" style="color:var(--text-muted);">DD = Degenerate Dimension (номер чека хранится в факте без отдельной таблицы)</div>
</section>

<section>
    <h2>Торговля &mdash; схема &laquo;Снежинка&raquo;</h2>
    <div class="tables-row">
        <div class="er-entity" style="min-width:110px;">
            <div class="entity-title" style="background:#e91e63;">dim_category</div>
            <div class="er-field"><span class="pk">PK</span> cat_key</div>
            <div class="er-field">category_name</div>
            <div class="er-field"><span class="fk">FK</span> dept_key</div>
        </div>
        <div class="er-link"><div class="er-link-inner"><span class="card-label">N</span><span class="link-arrow-r"></span><span class="link-line"></span><span class="card-label">1</span></div></div>
        <div class="er-entity" style="min-width:110px;">
            <div class="entity-title" style="background:#e91e63;">dim_department</div>
            <div class="er-field"><span class="pk">PK</span> dept_key</div>
            <div class="er-field">dept_name</div>
        </div>
        <div class="er-entity" style="min-width:130px;">
            <div class="entity-title" style="background:var(--accent6);">dim_product</div>
            <div class="er-field"><span class="pk">PK</span> product_key</div>
            <div class="er-field">product_name</div>
            <div class="er-field">brand</div>
            <div class="er-field"><span class="fk">FK</span> cat_key</div>
            <div class="er-field"><span class="fk">FK</span> supplier_key</div>
        </div>
        <div class="er-link"><div class="er-link-inner"><span class="card-label">1</span><span class="link-line"></span><span class="link-arrow-l"></span><span class="card-label">N</span></div></div>
        <div class="er-entity accent2" style="min-width:160px;">
            <div class="entity-title">fact_sales</div>
            <div class="er-field"><span class="fk">FK</span> date_key</div>
            <div class="er-field"><span class="fk">FK</span> product_key</div>
            <div class="er-field"><span class="fk">FK</span> store_key</div>
            <div class="er-field"><span class="metric">M</span> quantity</div>
            <div class="er-field"><span class="metric">M</span> amount</div>
        </div>
        <div class="er-link"><div class="er-link-inner"><span class="card-label">N</span><span class="link-arrow-r"></span><span class="link-line"></span><span class="card-label">1</span></div></div>
        <div class="er-entity" style="min-width:120px;">
            <div class="entity-title" style="background:#7c3aed;">dim_supplier</div>
            <div class="er-field"><span class="pk">PK</span> supplier_key</div>
            <div class="er-field">supplier_name</div>
            <div class="er-field"><span class="fk">FK</span> country_key</div>
        </div>
    </div>
    <div class="highlight-box warning mt-10">
        <strong>Snowflake в торговле:</strong> Иерархия товаров (товар &rarr; категория &rarr; отдел) нормализована. Оправдано при миллионах SKU и десятках тысяч категорий. В остальных случаях &mdash; денормализуем в звезду.
    </div>
</section>

<section>
    <h2>Торговля: типичные аналитические запросы</h2>
    <pre><code class="language-sql">-- ТОП-10 товаров по выручке за квартал
SELECT p.product_name, p.brand,
       SUM(f.sales_amount) AS revenue,
       SUM(f.quantity)      AS units_sold
FROM fact_sales f
JOIN dim_product p ON f.product_key = p.product_key
JOIN dim_date    d ON f.date_key    = d.date_key
WHERE d.year = 2025 AND d.quarter = 1
GROUP BY p.product_name, p.brand
ORDER BY revenue DESC
LIMIT 10;

-- Эффективность промоакций: средний чек с/без скидки
SELECT pr.promo_type,
       COUNT(*)               AS transactions,
       AVG(f.sales_amount)    AS avg_receipt,
       SUM(f.discount)        AS total_discount
FROM fact_sales f
JOIN dim_promotion pr ON f.promo_key = pr.promo_key
GROUP BY pr.promo_type;</code></pre>
</section>

<!-- ФИНАНСЫ -->
<section>
    <h2>Финансы (Banking) &mdash; схема &laquo;Звезда&raquo;</h2>
    <div class="star-layout">
        <div class="er-entity star-top" style="min-width:130px;">
            <div class="entity-title">dim_date</div>
            <div class="er-field"><span class="pk">PK</span> date_key</div>
            <div class="er-field">full_date</div>
            <div class="er-field">month, quarter, year</div>
            <div class="er-field">is_business_day</div>
            <div class="er-field">fiscal_period</div>
        </div>
        <div class="er-entity star-left" style="min-width:140px;">
            <div class="entity-title" style="background:#9c27b0;">dim_account</div>
            <div class="er-field"><span class="pk">PK</span> account_key</div>
            <div class="er-field">account_number</div>
            <div class="er-field">account_type</div>
            <div class="er-field">currency</div>
            <div class="er-field">branch_name</div>
            <div class="er-field">open_date</div>
        </div>
        <div class="er-entity accent2 star-center" style="min-width:180px;">
            <div class="entity-title">fact_transaction</div>
            <div class="er-field"><span class="fk">FK</span> date_key</div>
            <div class="er-field"><span class="fk">FK</span> account_key</div>
            <div class="er-field"><span class="fk">FK</span> customer_key</div>
            <div class="er-field"><span class="fk">FK</span> channel_key</div>
            <div class="er-field">transaction_id (DD)</div>
            <div class="er-field"><span class="metric">M</span> amount</div>
            <div class="er-field"><span class="metric">M</span> fee</div>
            <div class="er-field">direction (debit/credit)</div>
        </div>
        <div class="er-entity star-right" style="min-width:130px;">
            <div class="entity-title" style="background:var(--accent6);">dim_customer</div>
            <div class="er-field"><span class="pk">PK</span> customer_key</div>
            <div class="er-field">full_name</div>
            <div class="er-field">segment (VIP/retail)</div>
            <div class="er-field">region, city</div>
            <div class="er-field">registration_date</div>
        </div>
        <div class="er-entity star-bottom" style="min-width:130px;">
            <div class="entity-title" style="background:#dc3545;">dim_channel</div>
            <div class="er-field"><span class="pk">PK</span> channel_key</div>
            <div class="er-field">channel_name</div>
            <div class="er-field">(ATM, Online, Branch)</div>
        </div>
        <div class="star-conn star-conn-top vert"><span>1</span><span class="conn-v"></span><span>N</span></div>
        <div class="star-conn star-conn-left"><span>1</span><span class="conn-h"></span><span>N</span></div>
        <div class="star-conn star-conn-right"><span>N</span><span class="conn-h"></span><span>1</span></div>
        <div class="star-conn star-conn-bottom vert"><span>N</span><span class="conn-v"></span><span>1</span></div>
    </div>
</section>

<section>
    <h2>Финансы: Periodic Snapshot &mdash; остатки</h2>
    <div class="highlight-box warning">
        <strong>Остатки на счетах</strong> &mdash; классический пример <strong>Periodic Snapshot</strong>. Одна строка = один счёт за один день. Метрика balance &mdash; semi-additive (нельзя суммировать по времени!).
    </div>
    <div class="tables-row mt-10">
        <div class="er-entity accent2" style="min-width:200px;">
            <div class="entity-title">fact_account_snapshot</div>
            <div class="er-field"><span class="fk">FK</span> date_key</div>
            <div class="er-field"><span class="fk">FK</span> account_key</div>
            <div class="er-field"><span class="metric">M</span> balance (semi-additive!)</div>
            <div class="er-field"><span class="metric">M</span> txn_count_day</div>
            <div class="er-field"><span class="metric">M</span> debit_total</div>
            <div class="er-field"><span class="metric">M</span> credit_total</div>
        </div>
    </div>
    <pre class="mt-10"><code class="language-sql">-- Суммарный остаток по всем счетам на конец месяца
-- НЕЛЬЗЯ: SUM(balance) по всем дням — получим бессмыслицу!
-- ПРАВИЛЬНО: берём остаток на последний день периода
SELECT d.month, SUM(f.balance) AS total_balance
FROM fact_account_snapshot f
JOIN dim_date d ON f.date_key = d.date_key
WHERE d.full_date = (
    SELECT MAX(d2.full_date) FROM dim_date d2
    WHERE d2.month = d.month AND d2.year = d.year
)
GROUP BY d.month;</code></pre>
</section>

<!-- ТЕЛЕКОМ -->
<section>
    <h2>Телеком (Telecom) &mdash; схема &laquo;Звезда&raquo;</h2>
    <div class="star-layout">
        <div class="er-entity star-top" style="min-width:130px;">
            <div class="entity-title">dim_date</div>
            <div class="er-field"><span class="pk">PK</span> date_key</div>
            <div class="er-field">full_date</div>
            <div class="er-field">month, quarter, year</div>
            <div class="er-field">day_type (рабоч./вых.)</div>
        </div>
        <div class="er-entity star-left" style="min-width:140px;">
            <div class="entity-title" style="background:#00bcd4;">dim_subscriber</div>
            <div class="er-field"><span class="pk">PK</span> subscriber_key</div>
            <div class="er-field">phone_number</div>
            <div class="er-field">tariff_plan</div>
            <div class="er-field">segment (B2B/B2C)</div>
            <div class="er-field">region</div>
            <div class="er-field">activation_date</div>
        </div>
        <div class="er-entity accent2 star-center" style="min-width:180px;">
            <div class="entity-title">fact_cdr</div>
            <div class="er-field"><span class="fk">FK</span> date_key</div>
            <div class="er-field"><span class="fk">FK</span> subscriber_key</div>
            <div class="er-field"><span class="fk">FK</span> service_key</div>
            <div class="er-field"><span class="fk">FK</span> cell_tower_key</div>
            <div class="er-field">cdr_id (DD)</div>
            <div class="er-field"><span class="metric">M</span> duration_sec</div>
            <div class="er-field"><span class="metric">M</span> data_mb</div>
            <div class="er-field"><span class="metric">M</span> charge_amount</div>
        </div>
        <div class="er-entity star-right" style="min-width:130px;">
            <div class="entity-title" style="background:var(--accent6);">dim_service</div>
            <div class="er-field"><span class="pk">PK</span> service_key</div>
            <div class="er-field">service_type</div>
            <div class="er-field">(Voice/SMS/Data/MMS)</div>
            <div class="er-field">is_roaming</div>
        </div>
        <div class="er-entity star-bottom" style="min-width:140px;">
            <div class="entity-title" style="background:#7c3aed;">dim_cell_tower</div>
            <div class="er-field"><span class="pk">PK</span> tower_key</div>
            <div class="er-field">tower_id</div>
            <div class="er-field">location (lat/lon)</div>
            <div class="er-field">city, region</div>
            <div class="er-field">technology (4G/5G)</div>
        </div>
        <div class="star-conn star-conn-top vert"><span>1</span><span class="conn-v"></span><span>N</span></div>
        <div class="star-conn star-conn-left"><span>1</span><span class="conn-h"></span><span>N</span></div>
        <div class="star-conn star-conn-right"><span>N</span><span class="conn-h"></span><span>1</span></div>
        <div class="star-conn star-conn-bottom vert"><span>N</span><span class="conn-v"></span><span>1</span></div>
    </div>
    <div class="smaller text-center mt-10" style="color:var(--text-muted);">CDR = Call Detail Record &mdash; запись о каждом звонке/сессии, миллиарды строк/месяц</div>
</section>

<section>
    <h2>Телеком: типичные аналитические запросы</h2>
    <pre><code class="language-sql">-- Среднее потребление данных по тарифным планам
SELECT s.tariff_plan,
       COUNT(DISTINCT s.subscriber_key) AS subscribers,
       ROUND(AVG(f.data_mb), 1)         AS avg_data_mb,
       ROUND(SUM(f.charge_amount), 2)   AS total_revenue
FROM fact_cdr f
JOIN dim_subscriber s ON f.subscriber_key = s.subscriber_key
JOIN dim_date d        ON f.date_key = d.date_key
JOIN dim_service sv    ON f.service_key = sv.service_key
WHERE d.year = 2025 AND d.quarter = 1
  AND sv.service_type = 'Data'
GROUP BY s.tariff_plan
ORDER BY total_revenue DESC;

-- Нагрузка на базовые станции (для планирования сети)
SELECT ct.city, ct.technology,
       COUNT(*) AS sessions,
       SUM(f.data_mb) / 1024 AS total_gb
FROM fact_cdr f
JOIN dim_cell_tower ct ON f.cell_tower_key = ct.tower_key
JOIN dim_date d ON f.date_key = d.date_key
WHERE d.full_date = '2025-03-15'
GROUP BY ct.city, ct.technology
ORDER BY total_gb DESC;</code></pre>
</section>

<!-- ТРАНСПОРТ -->
<section>
    <h2>Транспорт (Logistics) &mdash; схема &laquo;Звезда&raquo;</h2>
    <div class="star-layout">
        <div class="er-entity star-top" style="min-width:130px;">
            <div class="entity-title">dim_date</div>
            <div class="er-field"><span class="pk">PK</span> date_key</div>
            <div class="er-field">full_date</div>
            <div class="er-field">month, year</div>
            <div class="er-field">season</div>
        </div>
        <div class="er-entity star-left" style="min-width:140px;">
            <div class="entity-title" style="background:#ff9800;">dim_route</div>
            <div class="er-field"><span class="pk">PK</span> route_key</div>
            <div class="er-field">origin_city</div>
            <div class="er-field">destination_city</div>
            <div class="er-field">distance_km</div>
            <div class="er-field">transport_type</div>
        </div>
        <div class="er-entity accent2 star-center" style="min-width:180px;">
            <div class="entity-title">fact_shipment</div>
            <div class="er-field"><span class="fk">FK</span> date_key</div>
            <div class="er-field"><span class="fk">FK</span> route_key</div>
            <div class="er-field"><span class="fk">FK</span> vehicle_key</div>
            <div class="er-field"><span class="fk">FK</span> driver_key</div>
            <div class="er-field"><span class="fk">FK</span> customer_key</div>
            <div class="er-field">waybill_number (DD)</div>
            <div class="er-field"><span class="metric">M</span> weight_kg</div>
            <div class="er-field"><span class="metric">M</span> delivery_hours</div>
            <div class="er-field"><span class="metric">M</span> fuel_litres</div>
            <div class="er-field"><span class="metric">M</span> cost</div>
        </div>
        <div class="er-entity star-right" style="min-width:130px;">
            <div class="entity-title" style="background:var(--accent6);">dim_vehicle</div>
            <div class="er-field"><span class="pk">PK</span> vehicle_key</div>
            <div class="er-field">reg_number</div>
            <div class="er-field">model, brand</div>
            <div class="er-field">capacity_kg</div>
            <div class="er-field">fuel_type</div>
        </div>
        <div class="er-entity star-bottom" style="min-width:130px;">
            <div class="entity-title" style="background:#7c3aed;">dim_driver</div>
            <div class="er-field"><span class="pk">PK</span> driver_key</div>
            <div class="er-field">full_name</div>
            <div class="er-field">license_class</div>
            <div class="er-field">experience_years</div>
        </div>
        <div class="star-conn star-conn-top vert"><span>1</span><span class="conn-v"></span><span>N</span></div>
        <div class="star-conn star-conn-left"><span>1</span><span class="conn-h"></span><span>N</span></div>
        <div class="star-conn star-conn-right"><span>N</span><span class="conn-h"></span><span>1</span></div>
        <div class="star-conn star-conn-bottom vert"><span>N</span><span class="conn-v"></span><span>1</span></div>
    </div>
</section>

<section>
    <h2>Транспорт: Accumulating Snapshot</h2>
    <div class="highlight-box warning">
        <strong>Accumulating Snapshot</strong> &mdash; идеален для отслеживания жизненного цикла доставки. Одна строка = одна доставка, обновляется по мере прохождения этапов.
    </div>
    <div class="tables-row mt-10">
        <div class="er-entity accent2" style="min-width:280px;">
            <div class="entity-title">fact_delivery_pipeline</div>
            <div class="er-field"><span class="pk">PK</span> delivery_key</div>
            <div class="er-field"><span class="fk">FK</span> order_date_key (Role-Playing!)</div>
            <div class="er-field"><span class="fk">FK</span> pickup_date_key</div>
            <div class="er-field"><span class="fk">FK</span> delivery_date_key</div>
            <div class="er-field"><span class="fk">FK</span> route_key</div>
            <div class="er-field"><span class="metric">M</span> order_to_pickup_days</div>
            <div class="er-field"><span class="metric">M</span> pickup_to_delivery_days</div>
            <div class="er-field"><span class="metric">M</span> total_days</div>
            <div class="er-field">status (in_transit / delivered)</div>
        </div>
    </div>
    <div class="highlight-box mt-10">
        <strong>Role-Playing Dimension:</strong> dim_date используется в 3 ролях: дата заказа, дата забора, дата доставки. Одна физическая таблица, 3 FK.
    </div>
</section>

<!-- ПРОМЫШЛЕННОСТЬ -->
<section>
    <h2>Промышленность (Manufacturing) &mdash; &laquo;Руда+&raquo;</h2>
    <h3>Звёздная схема: мониторинг OEE</h3>
    <div class="star-layout">
        <div class="er-entity star-top" style="min-width:130px;">
            <div class="entity-title">dim_time</div>
            <div class="er-field"><span class="pk">PK</span> time_key</div>
            <div class="er-field">full_date, shift</div>
            <div class="er-field">month, quarter, year</div>
        </div>
        <div class="er-entity star-left" style="min-width:130px;">
            <div class="entity-title" style="background:#607d8b;">dim_equipment</div>
            <div class="er-field"><span class="pk">PK</span> eq_key</div>
            <div class="er-field">name, type</div>
            <div class="er-field">manufacturer</div>
            <div class="er-field">mine_name</div>
            <div class="er-field">commission_date</div>
        </div>
        <div class="er-entity accent2 star-center" style="min-width:200px;">
            <div class="entity-title">fact_oee</div>
            <div class="er-field"><span class="fk">FK</span> time_key</div>
            <div class="er-field"><span class="fk">FK</span> eq_key</div>
            <div class="er-field"><span class="fk">FK</span> mine_key</div>
            <div class="er-field"><span class="metric">M</span> planned_time_min</div>
            <div class="er-field"><span class="metric">M</span> actual_run_min</div>
            <div class="er-field"><span class="metric">M</span> ideal_output</div>
            <div class="er-field"><span class="metric">M</span> actual_output</div>
            <div class="er-field"><span class="metric">M</span> good_output</div>
            <div class="er-field"><span class="metric">M</span> downtime_min</div>
        </div>
        <div class="er-entity star-right" style="min-width:130px;">
            <div class="entity-title" style="background:var(--accent6);">dim_mine</div>
            <div class="er-field"><span class="pk">PK</span> mine_key</div>
            <div class="er-field">mine_name</div>
            <div class="er-field">region, city</div>
            <div class="er-field">depth_m</div>
        </div>
        <div class="star-conn star-conn-top vert"><span>1</span><span class="conn-v"></span><span>N</span></div>
        <div class="star-conn star-conn-left"><span>1</span><span class="conn-h"></span><span>N</span></div>
        <div class="star-conn star-conn-right"><span>N</span><span class="conn-h"></span><span>1</span></div>
    </div>
    <div class="highlight-box success mt-10">
        <strong>OEE = Availability &times; Performance &times; Quality</strong><br>
        Availability = actual_run / planned_time | Performance = actual_output / ideal_output | Quality = good_output / actual_output
    </div>
</section>

<section>
    <h2>Промышленность: SQL для расчёта OEE</h2>
    <pre><code class="language-sql">-- OEE по оборудованию за месяц
SELECT
    e.name                                           AS оборудование,
    e.type                                           AS тип,
    m.mine_name                                      AS шахта,
    -- Availability (Доступность)
    ROUND(SUM(f.actual_run_min)::numeric
        / NULLIF(SUM(f.planned_time_min), 0) * 100, 1) AS availability_pct,
    -- Performance (Производительность)
    ROUND(SUM(f.actual_output)::numeric
        / NULLIF(SUM(f.ideal_output), 0) * 100, 1)     AS performance_pct,
    -- Quality (Качество)
    ROUND(SUM(f.good_output)::numeric
        / NULLIF(SUM(f.actual_output), 0) * 100, 1)    AS quality_pct,
    -- OEE
    ROUND(
        (SUM(f.actual_run_min)::numeric / NULLIF(SUM(f.planned_time_min), 0))
      * (SUM(f.actual_output)::numeric / NULLIF(SUM(f.ideal_output), 0))
      * (SUM(f.good_output)::numeric / NULLIF(SUM(f.actual_output), 0))
      * 100, 1
    ) AS oee_pct
FROM fact_oee f
JOIN dim_equipment e ON f.eq_key   = e.eq_key
JOIN dim_mine      m ON f.mine_key = m.mine_key
JOIN dim_time      t ON f.time_key = t.time_key
WHERE t.year = 2025 AND t.month = 3
GROUP BY e.name, e.type, m.mine_name
ORDER BY oee_pct;</code></pre>
</section>

<section>
    <h2>Промышленность: схема &laquo;Снежинка&raquo; для телеметрии</h2>
    <div class="tables-row">
        <div class="er-entity" style="min-width:120px;">
            <div class="entity-title" style="background:#607d8b;">dim_eq_type</div>
            <div class="er-field"><span class="pk">PK</span> type_key</div>
            <div class="er-field">type_name</div>
            <div class="er-field">category</div>
        </div>
        <div class="er-link"><div class="er-link-inner"><span class="card-label">1</span><span class="link-line"></span><span class="link-arrow-l"></span><span class="card-label">N</span></div></div>
        <div class="er-entity" style="min-width:130px;">
            <div class="entity-title" style="background:#607d8b;">dim_equipment</div>
            <div class="er-field"><span class="pk">PK</span> eq_key</div>
            <div class="er-field">eq_name</div>
            <div class="er-field"><span class="fk">FK</span> type_key</div>
            <div class="er-field"><span class="fk">FK</span> mine_key</div>
        </div>
        <div class="er-link"><div class="er-link-inner"><span class="card-label">1</span><span class="link-line"></span><span class="link-arrow-l"></span><span class="card-label">N</span></div></div>
        <div class="er-entity accent2" style="min-width:170px;">
            <div class="entity-title">fact_telemetry</div>
            <div class="er-field"><span class="fk">FK</span> time_key</div>
            <div class="er-field"><span class="fk">FK</span> eq_key</div>
            <div class="er-field"><span class="fk">FK</span> sensor_key</div>
            <div class="er-field"><span class="metric">M</span> value</div>
        </div>
        <div class="er-link"><div class="er-link-inner"><span class="card-label">N</span><span class="link-arrow-r"></span><span class="link-line"></span><span class="card-label">1</span></div></div>
        <div class="er-entity" style="min-width:120px;">
            <div class="entity-title" style="background:var(--accent6);">dim_sensor</div>
            <div class="er-field"><span class="pk">PK</span> sensor_key</div>
            <div class="er-field">sensor_type</div>
            <div class="er-field"><span class="fk">FK</span> unit_key</div>
            <div class="er-field">min_threshold</div>
            <div class="er-field">max_threshold</div>
        </div>
        <div class="er-link"><div class="er-link-inner"><span class="card-label">N</span><span class="link-arrow-r"></span><span class="link-line"></span><span class="card-label">1</span></div></div>
        <div class="er-entity" style="min-width:100px;">
            <div class="entity-title" style="background:var(--accent6);">dim_unit</div>
            <div class="er-field"><span class="pk">PK</span> unit_key</div>
            <div class="er-field">unit_name</div>
            <div class="er-field">symbol</div>
        </div>
    </div>
    <div class="highlight-box warning mt-10">
        <strong>Снежинка в промышленности:</strong> dim_sensor нормализован (единицы измерения вынесены). Оправдано при сотнях типов датчиков с разными единицами измерения и порогами.
    </div>
</section>

<!-- Сводная таблица по отраслям -->
<section>
    <h2>Сводка: отраслевые модели</h2>
    <table style="width:98%; font-size:0.6em;">
        <thead><tr><th>Отрасль</th><th>Бизнес-процесс</th><th>Fact Table</th><th>Dimensions</th><th>Тип факта</th><th>Ключевые метрики</th></tr></thead>
        <tbody>
            <tr>
                <td><span class="badge" style="background:#e91e63;">Торговля</span></td>
                <td>Продажи</td><td>fact_sales</td>
                <td>date, store, product, promo</td>
                <td>Transaction</td>
                <td>quantity, amount, discount</td>
            </tr>
            <tr>
                <td><span class="badge" style="background:#9c27b0;">Финансы</span></td>
                <td>Операции / Остатки</td><td>fact_transaction, fact_snapshot</td>
                <td>date, account, customer, channel</td>
                <td>Transaction + Periodic</td>
                <td>amount, fee, balance</td>
            </tr>
            <tr>
                <td><span class="badge" style="background:#00bcd4;">Телеком</span></td>
                <td>CDR (звонки/сессии)</td><td>fact_cdr</td>
                <td>date, subscriber, service, tower</td>
                <td>Transaction</td>
                <td>duration, data_mb, charge</td>
            </tr>
            <tr>
                <td><span class="badge" style="background:#ff9800;">Транспорт</span></td>
                <td>Доставки</td><td>fact_shipment, fact_pipeline</td>
                <td>date, route, vehicle, driver</td>
                <td>Transaction + Accumulating</td>
                <td>weight, hours, fuel, cost</td>
            </tr>
            <tr>
                <td><span class="badge" style="background:#607d8b;">Промышл.</span></td>
                <td>OEE / Телеметрия</td><td>fact_oee, fact_telemetry</td>
                <td>time, equipment, mine, sensor</td>
                <td>Periodic + Transaction</td>
                <td>run_min, output, value</td>
            </tr>
        </tbody>
    </table>
</section>

<!-- ============================== -->
<!-- РАЗДЕЛ 7: КВИЗЫ И ОБСУЖДЕНИЕ  -->
<!-- ============================== -->
<section class="section-divider">
    <h1>7. Проверь себя</h1>
    <div class="divider-line"></div>
    <p style="font-size:0.9em;">Квизы, обсуждение, групповая работа</p>
</section>

<!-- Quiz 1 -->
<section>
    <h2>Квиз 1: Тип факта</h2>
    <div class="quiz-container">
        <h3>Ежедневный остаток на банковском счёте &mdash; это:</h3>
        <div class="quiz-option" onclick="checkAnswer(this, false)">A) Transaction Fact &mdash; каждая операция</div>
        <div class="quiz-option" onclick="checkAnswer(this, true)">B) Periodic Snapshot &mdash; состояние на конец дня</div>
        <div class="quiz-option" onclick="checkAnswer(this, false)">C) Accumulating Snapshot &mdash; жизненный цикл</div>
        <div class="quiz-option" onclick="checkAnswer(this, false)">D) Factless Fact &mdash; без метрик</div>
        <div class="quiz-feedback"></div>
    </div>
</section>

<!-- Quiz 2 -->
<section>
    <h2>Квиз 2: Тип метрики</h2>
    <div class="quiz-container">
        <h3>Содержание Fe% в руде &mdash; это метрика:</h3>
        <div class="quiz-option" onclick="checkAnswer(this, false)">A) Additive &mdash; можно суммировать по всем измерениям</div>
        <div class="quiz-option" onclick="checkAnswer(this, false)">B) Semi-additive &mdash; суммируется не по всем измерениям</div>
        <div class="quiz-option" onclick="checkAnswer(this, true)">C) Non-additive &mdash; только AVG, MIN, MAX</div>
        <div class="quiz-option" onclick="checkAnswer(this, false)">D) Derived &mdash; вычисляемая метрика</div>
        <div class="quiz-feedback"></div>
    </div>
</section>

<!-- Quiz 3 -->
<section>
    <h2>Квиз 3: Звезда или Снежинка?</h2>
    <div class="quiz-container">
        <h3>Какую схему рекомендует Кимбалл по умолчанию?</h3>
        <div class="quiz-option" onclick="checkAnswer(this, true)">A) Звезда &mdash; измерения денормализованы, минимум JOIN</div>
        <div class="quiz-option" onclick="checkAnswer(this, false)">B) Снежинка &mdash; измерения нормализованы, экономия места</div>
        <div class="quiz-option" onclick="checkAnswer(this, false)">C) 3НФ &mdash; полная нормализация всех таблиц</div>
        <div class="quiz-option" onclick="checkAnswer(this, false)">D) Зависит от объёма данных &mdash; нет общего правила</div>
        <div class="quiz-feedback"></div>
    </div>
</section>

<!-- Quiz 4 -->
<section>
    <h2>Квиз 4: SCD</h2>
    <div class="quiz-container">
        <h3>Оператор ПДМ Иванов А.А. повысил разряд с 5 до 6. Какой SCD сохранит полную историю?</h3>
        <div class="quiz-option" onclick="checkAnswer(this, false)">A) SCD Type 0 &mdash; оставить старое значение</div>
        <div class="quiz-option" onclick="checkAnswer(this, false)">B) SCD Type 1 &mdash; перезаписать на новое</div>
        <div class="quiz-option" onclick="checkAnswer(this, true)">C) SCD Type 2 &mdash; новая строка с valid_from / valid_to</div>
        <div class="quiz-option" onclick="checkAnswer(this, false)">D) SCD Type 3 &mdash; столбец prev_qualification</div>
        <div class="quiz-feedback"></div>
    </div>
</section>

<!-- Quiz 5 -->
<section>
    <h2>Квиз 5: Conformed Dimensions</h2>
    <div class="quiz-container">
        <h3>Зачем нужны Conformed Dimensions?</h3>
        <div class="quiz-option" onclick="checkAnswer(this, false)">A) Уменьшить размер базы данных</div>
        <div class="quiz-option" onclick="checkAnswer(this, true)">B) Обеспечить drill-across запросы между разными Data Marts</div>
        <div class="quiz-option" onclick="checkAnswer(this, false)">C) Ускорить загрузку ETL</div>
        <div class="quiz-option" onclick="checkAnswer(this, false)">D) Упростить бэкап базы данных</div>
        <div class="quiz-feedback"></div>
    </div>
</section>

<!-- Обсуждение -->
<section class="discussion">
    <div class="discussion-icon">&#128172;</div>
    <h2>Вопросы для обсуждения</h2>
    <div class="discussion-question">
        <strong>1.</strong> Вам нужно построить аналитику для &laquo;Руда+&raquo; по двум процессам: добыча и простои. Какие Conformed Dimensions вы выделите? Почему?
    </div>
    <div class="discussion-question">
        <strong>2.</strong> В телеком-компании CDR генерирует 500 млн строк/день. Стоит ли использовать звезду или лучше Snowflake? А может, вообще отказаться от Dimensional Modeling?
    </div>
    <div class="discussion-question">
        <strong>3.</strong> Чем отличается подход &laquo;храним исходные метрики, вычисляем производные&raquo; от &laquo;храним всё рассчитанным&raquo;? Когда каждый подход лучше?
    </div>
</section>

<!-- Групповая работа -->
<section class="group-work">
    <h2>Групповая работа: спроектируйте звёздную схему</h2>
    <div class="card-container">
        <div class="group-task">
            <p><span class="group-num">1</span> <strong>Группа &laquo;Торговля&raquo;</strong></p>
            <p>Сеть кофеен. Процесс: продажа напитков. Определите grain, dimensions, facts. Нарисуйте звезду.</p>
        </div>
        <div class="group-task">
            <p><span class="group-num">2</span> <strong>Группа &laquo;Финансы&raquo;</strong></p>
            <p>Банк. Процесс: выдача кредитов (Accumulating Snapshot). Определите этапы жизненного цикла кредита.</p>
        </div>
        <div class="group-task">
            <p><span class="group-num">3</span> <strong>Группа &laquo;Транспорт&raquo;</strong></p>
            <p>Служба доставки. Два процесса: рейсы и жалобы клиентов. Какие Conformed Dimensions?</p>
        </div>
        <div class="group-task">
            <p><span class="group-num">4</span> <strong>Группа &laquo;Промышленность&raquo;</strong></p>
            <p>&laquo;Руда+&raquo;: добавьте fact_safety_incident (инциденты ТБ). Какие dimensions? Какой тип факта?</p>
        </div>
    </div>
    <div class="smaller text-center mt-10" style="color:#7c3aed;">Время: 15 минут. Результат: схема на доске/бумаге + защита (3 мин)</div>
</section>

<!-- КЕЙС -->
<section class="case-study">
    <h2>Кейс: выбор схемы для &laquo;Руда+&raquo;</h2>
    <div class="case-box">
        <strong>Ситуация:</strong> MES-система &laquo;Руда+&raquo; собирает данные с 12 единиц оборудования в 3 шахтах. Планируется расширение до 10 шахт и 200 единиц техники. Нужно построить аналитическое хранилище для:
        <ul>
            <li>Ежедневных отчётов по добыче (для руководства)</li>
            <li>OEE-мониторинга (для инженеров)</li>
            <li>Предиктивного обслуживания на основе телеметрии (для ML-инженеров)</li>
        </ul>
    </div>
    <div class="card-container mt-10">
        <div class="card">
            <h4>Вопрос 1</h4>
            <p>Сколько Data Marts (витрин) вы создадите? Какие бизнес-процессы они покрывают?</p>
        </div>
        <div class="card accent2">
            <h4>Вопрос 2</h4>
            <p>Для телеметрии (1000 показаний/сек): звезда, снежинка или что-то другое (TimescaleDB, ClickHouse)?</p>
        </div>
        <div class="card accent6">
            <h4>Вопрос 3</h4>
            <p>Какие измерения будут Conformed? Какие SCD-типы для dim_equipment и dim_operator?</p>
        </div>
    </div>
</section>

<!-- ИТОГИ -->
<section>
    <h2>Ключевые выводы</h2>
    <div class="card-container">
        <div class="card">
            <h4>Dimensional Modeling</h4>
            <p>Факты + Измерения. 4 шага Кимбалла. Conformed Dimensions для интеграции.</p>
        </div>
        <div class="card accent2">
            <h4>Звезда vs Снежинка</h4>
            <p>Звезда &mdash; по умолчанию (простота, скорость). Снежинка &mdash; при огромных измерениях.</p>
        </div>
        <div class="card accent6">
            <h4>Отраслевая специфика</h4>
            <p>Паттерны повторяются: Transaction + Periodic Snapshot + SCD Type 2 покрывают 80% задач.</p>
        </div>
    </div>
    <div class="highlight-box mt-20">
        <strong>Что дальше:</strong> На практическом занятии реализуем звёздную схему для &laquo;Руда+&raquo; в PostgreSQL, загрузим данные и напишем аналитические запросы.
    </div>
</section>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/reveal.js@4.6.1/dist/reveal.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reveal.js@4.6.1/plugin/highlight/highlight.js"></script>
<script>
    Reveal.initialize({
        hash: true,
        slideNumber: 'c/t',
        showSlideNumber: 'all',
        transition: 'slide',
        transitionSpeed: 'default',
        width: 1200,
        height: 700,
        margin: 0.04,
        plugins: [RevealHighlight]
    });

    function checkAnswer(element, isCorrect) {
        const container = element.closest('.quiz-container');
        const options = container.querySelectorAll('.quiz-option');
        const feedback = container.querySelector('.quiz-feedback');
        options.forEach(opt => {
            opt.classList.remove('correct', 'incorrect');
            opt.style.pointerEvents = 'none';
        });
        if (isCorrect) {
            element.classList.add('correct');
            feedback.textContent = 'Правильно!';
            feedback.style.background = '#e8feef';
            feedback.style.color = '#155724';
        } else {
            element.classList.add('incorrect');
            options.forEach(opt => {
                if (opt.getAttribute('onclick').includes('true')) {
                    opt.classList.add('correct');
                }
            });
            feedback.textContent = 'Неправильно. Правильный ответ выделен зелёным.';
            feedback.style.background = '#fee8e8';
            feedback.style.color = '#721c24';
        }
        feedback.style.display = 'block';
        setTimeout(() => {
            options.forEach(opt => { opt.style.pointerEvents = 'auto'; });
        }, 3000);
    }
</script>
</body>
</html>
